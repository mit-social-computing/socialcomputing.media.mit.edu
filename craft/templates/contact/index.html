{% extends 'layouts/_text' %}

{% block content %}
{% macro errorList(errors) %}
    {% if errors %}
        <ul class="errors">
            {% for error in errors %}
                <li>{{ error }}</li>
            {% endfor %}
        </ul>
    {% endif %}
{% endmacro %}

{% from _self import errorList %}

<div id="thanks" style="display:none;">
    <p>Thanks for the message <span id="name"></span></p>
</div>

<form method="post" action="" class="form" accept-charset="UTF-8" id="contact">
    {{ getCsrfInput() }}

    <input type="hidden" name="age">
    <input type="hidden" name="action" value="contactForm/sendMessage">

    <h3><label for="fromName">Your Name</label></h3>
    <input id="fromName" type="text" name="fromName">

    <h3><label for="fromEmail">Your Email</label></h3>
    <input id="fromEmail" type="text" name="fromEmail">

    <h3><label for="subject">Subject</label></h3>
    <input id="subject" type="text" name="subject">

    <h3><label for="message">Message</label></h3>
    <textarea rows="10" cols="40" id="message" name="message"></textarea>

    <input type="submit" value="Send">
</form>

<script>
document.addEventListener('DOMContentLoaded', function(e) {
    $('#contact').submit(function(ev) {
        // Prevent the form from actually submitting
        ev.preventDefault();

        // Get the post data
        var data = $(this).serialize();

        // Send it to the server
        $.post('/contact', data, function(response) {
            if (response.success) {
                $('#name').html(data.fromName)
                $('#thanks').fadeIn();
                $('#contact').fadeOut()
            } else {
                // response.error will be an object containing any validation errors that occurred, indexed by field name
                // e.g. response.error.fromName => ['From Name is required']
                alert('An error occurred. Please try again.');
            }
        })
    })
})
</script>
{% endblock %}
